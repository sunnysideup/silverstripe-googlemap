jQuery(document).ready(function(){if("undefined"!==typeof GoogleMapConstructors)for(var g=0;g<GoogleMapConstructors.length;g++){var l=GoogleMapConstructors[g];GoogleMapConstructors[g].googleMap=new GoogleMapConstructor(l.divID,null,"GoogleMapConstructors["+g+"].googleMap.getMap()",l.options);GoogleMapConstructors[g].googleMap.init();if("undefined"!==typeof l.layers){var q=l.layers;if(0<q.length)for(var n=0;n<q.length;n++)GoogleMapConstructors[g].googleMap.addLayer(q[n].link,q[n].title)}"undefined"!==
typeof l.address&&0<l.address.length&&GoogleMapConstructors[g].googleMap.findAddress(l.address);if(0===g&&0<jQuery("#SearchByAddressForm_SearchByAddressForm").length){var a=GoogleMapConstructors[g].googleMap;jQuery("#SearchByAddressForm_SearchByAddressForm").ajaxForm({error:function(){a.recordError("Could not find address!")},success:function(b,c,d,e){"undefined"!==typeof b.ErrorMessage?a.recordError(b.ErrorMessage):(c=jQuery("base").attr("href")+"/googlemap/",c+=""+b.Action+"/",c+=""+b.ParentID+
"/",c+=""+b.Title+"/",c+=""+b.Lng+"/",c+=""+b.Lat+"/",c+=""+b.ClassNames+"/",GoogleMapConstructors[0].googleMap.addLayer(c,b.Title))},dataType:"json"})}}});
var GoogleMapTranslatableUserMessages={position_saved:"position saved.",return_to_position:"returned to saved position.",map_ready:"map ready.",currently_set_to:"currently set to: ",loading_map:"loading . . .",manually_added_point:"manually added point.",points:"points",updating_database:"updating database",drill_a_hole:"drill a hole",found_opposite:"Exact opposite point on earth - goodluck finding your way back...",antipodean_of:"Antipodean of",drag_instructions:"marker can be dragged to new location once this info window has been closed.",
partial_obscuring:"this marker (partially) obscures the following point(s):",and_with_spaces:" and ",error_in_zoom:"Error in MaxZoomService",select_this_point:"select this point",clear_last_route:"clear Last Route",calculate_route:"calculate route",alernatively:"Alternatively:",create_routes_using_current_points:"create route using current points.",this_point:"This Point",find_address:"find address",address_not_retrieved:"address could not be retrieved from server.",address_not_accurate:"NB: Address may not be accurate",
close:"close",remove:"remove",added_to_db:"added point to database",added_to_db_error:"could NOT add point to database",loaded:"loaded",error_in_loading:"sorry - could not load data",processing:"processing",of:"of",locations_added:"locations added",one_location_loaded:"one location loaded.",large_number_of_items:"location are being loaded. It may take a while for all the locations to show on the map, please be patient.",no_location_could_be_found:"No locations could be found.",updating_lists:"Updating lists . . .",
you_added:"You added",select_a_location:" - Highlight a Location on the Map - ",kml:"kml",hide:"hide [x]",show_help:"show help",can_not_hide_bar_in_full_screen_mode:"Can not hide this bar in full screen mode",searching_for_address:"searching for address . . .",added_position:"added position",address_finder_not_loaded:"ERROR: address finder not loaded.",address_not_found:"Sorry, we were unable to find that address.",address_search:"address search",address_found:"address found",no_valid_start:"No valid start location has been selected.",
no_valid_end:"No valid end location has been selected.",searching_for_route:"Searching for Route . . .",no_route_could_be_found:"No Route could be Found . . .",from:"from",to:"to",do_next:"do next"};
function GoogleMapConstructor(g,l,q,n){var a={variableName:q,mapObject:null,geocoder:null,directions:null,directionsDisplay:null,NZLongitude:"0.0001",NZLatitude:"0.0001",NZZoom:2,addedPoint:0,markersArray:[],_t:GoogleMapTranslatableUserMessages,addLayer:function(b,c){a.downloadXml(b,c);return!0},addPoint:function(b,c,d){b=a.createPointXml(c,b,d);a.processXml(b)},findAddress:function(b){a.showAddress(b);return!0},findRoute:function(){a.showRoute();return!0},savePosition:function(){a.savePositionNow(a.mapObject);
a.updateStatus(a._t.position_saved);return!0},goToSavedPosition:function(){a.returnToSavedPosition(a.mapObjec);a.updateStatus(a._t.return_to_position);return!0},mapTypesArray:function(a){var b=[];b[1]=google.maps.MapTypeId.ROADMAP;b[2]=google.maps.MapTypeId.SATELLITE;b[3]=google.maps.MapTypeId.HYBRID;b[4]=google.maps.MapTypeId.TERRAIN;return b[a]},zoomControlStyleArray:function(a){var b=[];b[1]=google.maps.ZoomControlStyle.SMALL;b[2]=google.maps.ZoomControlStyle.SMALL;b[3]=google.maps.ZoomControlStyle.LARGE;
return b[a]},setupMap:function(b){this.opts.mapControlSizeOneToThree=this.zoomControlStyleArray(this.opts.mapControlSizeOneToThree-0);var c={center:new google.maps.LatLng(this.opts.defaultLatitude,this.opts.defaultLongitude),zoom:this.opts.defaultZoom,mapTypeControl:this.opts.mapAddTypeControl,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_LEFT},scrollwheel:!1,panControl:!0,zoomControl:!0,zoomControlOptions:{style:this.opts.mapControlSizeOneToThree},
scaleControl:!0,scaleControlOptions:{position:google.maps.ControlPosition.BOTTOM_RIGHT}};a.mapObject=new google.maps.Map(document.getElementById(b),c);this.opts.addDirections&&(a.directions=new google.maps.DirectionsService,a.directionsDisplay=new google.maps.DirectionsRenderer,a.directionsDisplay.setMap(a.mapObject),google.maps.event.addListener(a.directions,"load",function(){a.directionsOnLoad()}),google.maps.event.addListener(a.directions,"error",this.directionsHandleErrors),G_START_ICON="",G_START_ICON.iconSize=
new google.maps.Size(0,0),G_START_ICON.image="",G_END_ICON=G_START_ICON.shadow="",G_END_ICON.iconSize=new google.maps.Size(0,0),G_END_ICON.image="",G_END_ICON.shadow="");google.maps.event.addListener(a.mapObject,"click",function(b){b=new google.maps.LatLng(b.latLng.lat(),b.latLng.lng(),!1);a.zoomTo(b,a.mapObject.getZoom()+1)});google.maps.event.addListener(a.mapObject,"rightclick",function(b){var c=new google.maps.LatLng(b.latLng.lat(),b.latLng.lng(),!1);b=new google.maps.Point(b.x,b.y);a.opts.addPointsToMap?
(c="Longitude ("+Math.round(1E4*b.x)/1E4+") and Latitude ("+Math.round(1E4*b.y)/1E4+")",b=new google.maps.LatLng(b.x,b.y),b=a.createPointXml(c,b,a._t.manually_added_point),a.processXml(b)):a.zoomTo(c,a.mapObject.getZoom()-1)});0<this.opts.viewFinderSize&&window.setTimeout(function(){},2E3)},basicResetMap:function(){a.mapObject.setCenter(this.opts.defaultLatitude,this.opts.defaultLongitude);a.mapObject.setZoom(this.opts.defaultZoom)},addViewFinder:function(b,c){var d=new google.maps.Size(b,c),e=new google.maps.OverviewMapControlOptions(d);
a.mapObject.addControl(e);window.setTimeout(function(){e.getOverviewMap();e.hide(!0)},1E3)},zoomTo:function(b,c){b&&c?(a.mapObject.setZoom(c),a.mapObject.panTo(b)):a.mapObject.setCenter(new google.maps.LatLng(b,!1))},savePositionNow:function(){a.previousPosition=a.mapObject.getCenter()},returnToSavedPosition:function(){a.previousPosition&&a.mapObject.panTo(a.previousPosition)},statusDivControl:function(){var b=document.createElement("div");new StatusControl(statusControlDiv,map);b.setAttribute("id",
"statusDivOnMap");b.style.backgroundColor="white";b.style.font="small Arial";b.style.border="1px solid black";b.style.padding="2px";b.style.zIndex="99999";b.style.marginRight="7px";google.maps.event.addDomListener(b,"click",function(){b.style.display="none"});a.mapObject.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(statusControlDiv);a.mapObject.getContainer().appendChild(b);return b},changeLayerVisibility:function(b){var c=1,d,e=0;this.layerInfo[b].show&&(c=0);for(var f=0;f<this.gmarkers.length;f++)this.gmarkers[f].layerId==
b&&(e++,1===c?(this.gmarkers[f].setVisible(!0),d="shown"):("undefined"!==typeof this.gmarkers[f].infowindow&&this.gmarkers[f].infowindow.close(),this.gmarkers[f].setVisible(!1),d="hidden"));this.layerInfo[b].show=c;this.updateLists();this.updateStatus(a._t.points+" ("+e+") "+d+".")},createMarker:function(b,c,d,e,f){var h=this.layerInfo.length-1,m=this.opts.markerOptions||{};f||(f="http://maps.google.com/mapfiles/marker_yellow"+c[0].toUpperCase()+".png");f=this.createStandardIcon(f);m.icon=f;m.title&&
(m.title=c);m.position=b;m.map=a.mapObject;var k=new google.maps.Marker(m);k.layerId=h;k.markerName=c;k.markerDesc=d.nodeValue;k.type="marker";k.serverId=e;this.opts.updateServerUrlDragend?(m.draggable=!0,k.draggable=!0,google.maps.event.addListener(k,"dragend",function(){a.updateStatus("<p>"+a._t.updating_database+"</p>");var b=k.getPoint().lng(),c=k.getPoint().lat();jQuery.get(a.opts.updateServerUrlDragend,{x:b,y:c,i:k.serverId,a:"move"},function(b){a.updateStatus("<p>"+b+"</p>")})})):(m.draggable=
!1,k.draggable=!1);b=a.retrieveInfoWindowContent(k);c=this.opts.infoWindowOptions||{};c.content=b;var g=new google.maps.InfoWindow(c);google.maps.event.addListener(k,"click",function(){g.open(a.mapObject,k);a.lastMarker=k;a.lastInfoWindow=g});google.maps.event.addListener(k,"rightclick",function(){k.setMap(null);a.updateLists();if(a.opts.updateServerUrlDragend){var b=k.getPoint().lng(),c=k.getPoint().lat();jQuery.get(a.opts.updateServerUrlDragend,{x:b,y:c,i:k.serverId,a:"remove"},function(b){a.updateStatus("<p>"+
b+"</p>")})}});k.setMap(a.mapObject);this.gmarkers.push(k);this.gmarkers.push(k);return k},retrieveInfoWindowContent:function(b){var c=a.checkForHiddenMarkers(b),d=b.markerName,e=b.markerDesc,f=b.getPosition(),h=[],m="";1<this.layerInfo[b.layerId].pointCount&&google.maps.event.addListener(b,"hideGroup",function(){a.changeLayerVisibility(b.layerId);infowindow.close()});this.opts.addAntipodean&&(h.push('<a href="#" onclick="google.maps.event.trigger('+a.variableName+".getMap().lastMarker,'clickAntipodean'); return false;\">"+
a._t.drill_a_hole+"</a>"),google.maps.event.addListener(b,"clickAntipodean",function(){a.mapObject.setZoom(6);var c=b.getPosition(),c=a.antipodeanPointer(c.lng(),c.lat()),d=a.checkLongitude(f.lng()),e=a.checkLatitude(f.lat()),c=a.createPointXml(a._t.antipodean_of+" "+b.markerName,c,a._t.found_opposite,d,e,3);a.processXml(c)}));b.draggable&&h.push("<b>"+a._t.drag_instructions+"</b>");if(c.length){for(var m=m+(' <p><span class="partialObscuring">'+a._t.partial_obscuring),k=0;k<c.length;k++){var g=c[k],
m=m+(' <a href="#" onclick="'+a.variableName+".showMarkerFromList("+g+'); return false;">'+this.gmarkers[g].markerName+"</a>");k<c.length-2?m+=", ":k==c.length-2&&(m+=a._t.and_with_spaces)}m+="</span></p>"}c='<div id="infoWindowTab1" class="infoWindowTab"><h1>'+d+"</h1>"+m+"<div>"+e+"</div>";this.opts.addZoomInButton&&h.push('<a href="#" onclick="google.maps.event.trigger('+a.variableName+".lastMarker,'clickZoomIn'); return false;\">zoom in</a>");this.opts.addDeleteMarkerButton&&h.push('<a href="#" onclick="google.maps.event.trigger('+
a.variableName+".lastMarker,'clickRemoveMe'); return false;\">"+this.opts.addDeleteMarkerButton+"</a>");h.length&&(c+='<p class="infoTabExtraLinks">'+h.join(", ")+".</p>");google.maps.event.addListener(b,"clickZoomIn",function(){(new google.maps.MaxZoomService).getMaxZoomAtLatLng(b.position,function(c){c.status!=google.maps.MaxZoomStatus.OK?a.recordError(a._t.error_in_zoom):(a.mapObject.setZoom(c.zoom),a.mapObject.setCenter(b.position))})});google.maps.event.addListener(b,"clickRemoveMe",function(){b.setMap(null)});
this.opts.addDirections&&(h="",this.opts.addDirections&&(this.currentFromLocation(),h='<p class="infoTabFromOption"> <b>'+a._t.from+':</b></p><p id="fromHereLink"> <a href="#" onclick="google.maps.event.trigger('+a.variableName+".lastMarker,'clickFromHere')\">"+a._t.select_this_point+"</a>:  "+this.currentFromLocation()+'</p><p class="infoTabToOption"> <b>'+a._t.to+':</b></p><p id="toHereLink"> <a href="#" onclick="google.maps.event.trigger('+a.variableName+".lastMarker,'clickToHere'); return false;\">"+
a._t.select_this_point+"</a>: "+this.currentToLocation()+'</p><p class="infoTabAlternative">',this.routeShown?h+=" <b>"+a._t.do_next+':</b></p><p> <a href="#" onclick="return google.maps.event.trigger('+a.variableName+'.lastMarker,\'clickClearRoute\'); return false;" id="clearRouteLink">'+a._t.clear_last_route+"</a> ":this.floatFrom||this.floatTo||this.to||this.from?h+="<b>"+a._t.do_next+':</b></p><p><a href="#" class="submitButton" onclick="google.maps.event.trigger('+a.variableName+'.lastMarker,\'clickFindRoute\'); return false;" id="calculateLinkRoute">'+
a._t.calculate_route+"</a>":1<this.layerInfo[b.layerId].pointCount&&20>this.layerInfo[b.layerId].pointCount&&(h+='<span class="alternatively">'+a._t.alernatively+'</p><p><a href="#" class="submitButton" onclick="google.maps.event.trigger('+a.variableName+'.lastMarker,\'joinTheDots\')" id="calculateLinkRoute">'+a._t.create_routes_using_current_points+"</a>"),h+="</p>",google.maps.event.addListener(b,"joinTheDots",function(){a.createRouteFromLayer(b.layerId)}),google.maps.event.addListener(b,"clickFromHere",
function(){a.from=d;a.floatFrom=new google.maps.LatLng(f.ob,f.pb);document.getElementById("fromHereLink").innerHTML=a._t.this_point}),google.maps.event.addListener(b,"clickToHere",function(){document.getElementById("toHereLink").innerHTML=a._t.this_point;a.to=d;a.floatTo=new google.maps.LatLng(f.ob,f.pb)}),google.maps.event.addListener(b,"clickFindRoute",function(){a.showRoute();"undefined"!==typeof b.infowindow&&b.infowindow.close()}),google.maps.event.addListener(b,"clickClearRoute",function(){a.clearRouteAll()})),
c=c+'<div id="infoWindowTab2" class="infoWindowTab">'+h+"</div>");this.opts.addCurrentAddressFinder&&(c=c+'<div id="infoWindowTab3" class="infoWindowTab"><a href="#" onclick="google.maps.event.trigger('+a.variableName+".lastMarker,'findAddressFromLngLat')\">"+a._t.find_address+"</a></div>",google.maps.event.addListener(b,"findAddressFromLngLat",function(){a.geocoder=new google.maps.Geocoder}));return c},openPolyInfoTabs:function(b,c){var d=b.markerDesc,e=this.opts.infoWindowOptions||{};1<this.layerInfo[b.layerId].pointCount&&
google.maps.event.addListener(b,"hideGroup",function(){a.changeLayerVisibility(b.layerId);"undefined"!==typeof b.infowindow&&b.infowindow.close()});d='<div id="infoWindowTab1" class="infoWindowTab"><div>'+d+'</div><p class="infoTabBasicLinks"><a href="#" onclick="'+a.variableName+'.lastMarker.infowindow.close(); return false;">'+a._t.close+'</a>, <a href="#" onclick="google.maps.event.trigger('+a.variableName+".lastMarker,'clickHideMe')l return false;\">"+a._t.remove+"</a>.</p>";google.maps.event.addListener(b,
"clickHideMe",function(){"undefined"!==typeof b.infowindow&&b.infowindow.close();b.setVisible(!1);a.updateLists()});c?a.mapObject.openInfoWindowHtml(c.getCenter(),d,e):a.mapObject.openInfoWindowHtml(b.getVertex(Math.floor(b.getVertexCount()/2)),d,e)},createStandardIcon:function(b){return{url:b,size:new google.maps.Size(this.opts.iconWidth,this.opts.iconHeight),anchor:new google.maps.Point(Math.round(this.opts.iconWidth/2),this.opts.iconHeight)}},createPointXml:function(b,c,d,e,f,h,m){e||(e=c.x);f||
(f=c.y);h||(h=5);b='<?xml version="1.0" encoding="UTF-8"?><kml xmlns="http://earth.google.com/kml/2.1"><Document><mapinfo><title>'+b+"</title><longitude>"+e+"</longitude><latitude>"+f+"</latitude><zoom>"+h+"</zoom><pointcount>1</pointcount><info>"+m+"</info></mapinfo><Placemark> <id>"+("Marker_manuallyAdded"+a.layerInfo.length)+"</id> <name>"+b+"</name> <Point><coordinates>"+c.lng()+","+c.lat()+"</coordinates></Point> <description><![CDATA[ <p>"+d+"</p>]]\x3e</description></Placemark></Document></kml>";
a.opts.updateServerUrlDragend&&(d=c.split(","),c=parseFloat(d[0]),d=parseFloat(d[1]),jQuery.get(a.opts.updateServerUrlDragend,{x:c,y:d,i:0,a:"add"},function(b){0<parseInt(b)?(a.updateStatus("<p>"+a._t.added_to_db+"</p>"),a.lastMarker.serverId=b):a.updateStatus("<p>"+a._t.added_to_db_error+"</p>")}));return xmlParse(b)},downloadXml:function(b){var c;c=this.layerInfo.inSubArray("url",b);!0===c?(this.updateStatus(a._t.loaded),this.layerInfo[c-1].show||this.changeLayerVisibility(c-1)):(this.updateStatus(a._t.loading_map),
this.latestUrl=b,downloadUrl(b,function(b){a.processXml(b)}))},processXml:function(b){this.bounds=new google.maps.LatLngBounds;if(0<typeof b.getElementsByTagName("ErrorMessage").length)a.recordError(b.getElementsByTagName("ErrorMessage")[0]);else if(0<b.getElementsByTagName("pointcount").length){var c=b.getElementsByTagName("pointcount")[0].childNodes[0].nodeValue,c=parseInt(c);this.tooManyPointsWarning(c+1);var d=null;if(0<c){var d=this.layerInfo.length,e={},f=[];e.show=1;e.url=this.latestUrl;this.latestUrl=
"";e.pointCount=c;var h=b.getElementsByTagName("mapinfo")[0],m=b.getElementsByTagName("Placemark");e.title=h.getElementsByTagName("title")[0].firstChild.nodeValue;null!==h.getElementsByTagName("info")[0].firstChild&&(e.info=h.getElementsByTagName("info")[0].firstChild.nodeValue);e.a=h.getElementsByTagName("latitude")[0].firstChild.nodeValue;e.o=h.getElementsByTagName("longitude")[0].firstChild.nodeValue;e.z=h.getElementsByTagName("zoom")[0].firstChild.nodeValue;var k=d+1,d=0;k>this.opts.iconMaxCount&&
(k=1);h="";k&&(this.opts.iconFolder||this.opts.defaultIconUrl)&&(h=this.opts.defaultIconUrl||this.opts.iconFolder+"i"+k+"."+this.opts.iconExtension);this.layerInfo.push(e);for(var g=[],k=g=null,e=0;e<m.length;e++){var l=m[e].getElementsByTagName("id")[0].childNodes[0],n=m[e].getElementsByTagName("name")[0].childNodes[0].nodeValue,q=m[e].getElementsByTagName("description")[0].childNodes[0],p=null;0<m[e].getElementsByTagName("styleUrl").length&&(p=m[e].getElementsByTagName("styleUrl")[0],p=p.substring(1,
p.length));var u="";""!==h&&(u=h);if(p)for(var t=b.getElementsByTagName("Style"),r=0;r<t.length;r++)t[r].getAttribute("id")&&t[r].getAttribute("id")==p&&(d++,u=t[r].getElementsByTagName("Icon")[0].childNodes[0]);p=m[e].getElementsByTagName("coordinates")[0].childNodes[0].nodeValue;p=p.replace(/\s+/g," ");p=p.replace(/^ /,"");p=p.replace(/, /,",");r=p.split(" ");if(1<r.length){l=[];p=new google.maps.LatLngBounds;for(t=0;t<r.length-1;t++)g=r[t].split(","),g=new google.maps.LatLng(parseFloat(g[1]),parseFloat(g[0])),
l.push(g),this.bounds.extend(g),p.extend(g);this.opts.polyIcon&&(u=this.opts.polyIcon);var r=this.opts.lineWidth,v=this.opts.lineColour,w=this.opts.lineOpacity,t=m[e].getElementsByTagName("LineString"),x=m[e].getElementsByTagName("Polygon");t.length?t=this.createPolyline(l,v,r,w,n,q):x.length?t=this.createPolygon(l,v,r,w,this.opts.fillColour,this.opts.fillOpacity,p,n,q):a.recordError(a._t.error_in_loading)}else g=r[0].split(","),g=new google.maps.LatLng(parseFloat(g[1]),parseFloat(g[0])),this.bounds.extend(g),
this.updateStatus(a._t.processing+" "+e+" "+a._t.of+" "+c+"."),k=this.createMarker(g,n,q,l,u);f.inArray(u)||f.push(u)}d=this.layerInfo.length-1;this.layerInfo[d].iconUrl=f;1<c?a.mapObject.fitBounds(this.bounds):a.mapObject.panTo(g);this.updateLists();k.getVisible||"undefined"!==typeof k.infowindow&&k.infowindow.close();1<c?this.updateStatus(c+" "+a._t.locations_added+"."):(window.setTimeout(function(){google.maps.event.trigger(a.gmarkers[a.gmarkers.length-1],"click");a.mapObject.panBy(0,1)},300),
this.updateStatus(a._t.one_location_loaded))}else{c=b.getElementsByTagName("title")[0];f=b.getElementsByTagName("errormessage");if(0<f.length)for(e=0;e<f.length;e++)m=b.getElementsByTagName("errormessage")[e].innerHTML,a.recordError(m);this.opts.titleId&&(el=document.getElementById(this.opts.titleId),el.innerHTML=c);this.opts.changePageTitle&&document.title&&(document.title=c)}}},tooManyPointsWarning:function(b){100<b?this.updateStatus(b+" "+a._t.large_number_of_items):0===b&&this.updateStatus(a._t.no_location_could_be_found)},
updateLists:function(){this.updateStatus(a._t.updating_lists);var b=[];if(this.opts.sideBarId||this.opts.dropBoxId||this.opts.layerListId){for(var c=[],d=0;d<this.layerInfo.length;d++)this.layerInfo[d].show=0;for(d=0;d<this.gmarkers.length;d++)this.gmarkers[d].getVisible()&&(this.layerInfo[this.gmarkers[d].layerId].show=1,c.inArray(this.gmarkers[d].markerName)||b.push(this.gmarkers[d].markerName+"$$$"+d),c.push(this.gmarkers[d].markerName))}c=1<this.gmarkers.length?"block":"none";d=1<this.layerInfo.length?
"block":"none";this.opts.sideBarId&&(jQuery("#"+this.opts.sideBarId).css("display",c),this.createSideBar(b));this.opts.dropBoxId&&(jQuery("#"+this.opts.dropBoxId).css("display",c),this.createDropDown(b));this.opts.titleId&&this.updateTitles();this.opts.layerListId&&(jQuery("#"+this.opts.layerListId).css("display",d),this.updateLayerList());this.updateStatus(a._t.map_ready)},createSideBar:function(b){if(this.opts.sideBarId){var c="",c="",d=document.getElementById(this.opts.sideBarId);if(null!==d){if(1<
b.length){for(var e='<ul id="'+this.opts.sideBarId+'list">',f=0;f<b.length;f++)var c=b[f].split("$$$",2),h=c[1],c=this.gmarkers[h].layerId,e=-1==String(this.gmarkers[h].serverId).indexOf("manuallyAdded",0)?e+('<li class="forLayer'+c+" icon"+h+'"> <a href="'+this.currentPageURL+"#"+a.mapDivName+'" onclick="'+a.variableName+".showMarkerFromList("+h+'); return false;">'+this.gmarkers[h].markerName+'</a> <div class="infowindowDetails">'+this.gmarkers[h].markerDesc+"</div></li>"):e+('<li class="forLayer'+
c+'">'+a._t.you_added+': <a href="'+this.currentPageURL+"#"+a.mapDivName+'" onclick="'+a.variableName+".showMarkerFromList("+h+'); return false;">'+this.gmarkers[h].markerName+"</a></li>");d.innerHTML=e+"</ul>";"undefined"!==typeof AdjustHeightsForGoogleMap&&(AdjustHeightsForGoogleMap.boxesSelector="#"+this.opts.sideBarId+"list > li",jQuery(window).resize(function(){AdjustHeightsForGoogleMap.adjustBoxes()()}),AdjustHeightsForGoogleMap.adjustBoxes()())}}else console.debug("you defined the dropbox like this "+
this.opts.sideBarId+", but it does not exist")}},createDropDown:function(b){if(this.opts.dropBoxId&&1<b.length){var c=document.getElementById(this.opts.dropBoxId);if(null!==c){for(var d='<select onchange="GMO.showMarkerFromList(this.value);"><option selected="selected">'+a._t.select_a_location+" </option>",e=0;e<b.length;e++)i=b[e].split("$$$",2)[1],d+='<option value="'+i+'">'+this.gmarkers[i].markerName+"</option>";c.innerHTML=d+"</select>"}else console.debug("you defined the dropbox like this "+
this.opts.dropBoxId+", but it does not exist")}},updateLayerList:function(){if(this.opts.layerListId){var b=document.getElementById(this.opts.layerListId);if(null!==b){for(var c="<ul>",d,e,f,h=0;h<this.layerInfo.length;h++){1==this.layerInfo[h].show?(f="hide",d="layerListShown",e=""):(f="show",d="layerListHidden",e=this.opts.hiddenLayersRemovedFromList?' style="display: none;"':' style="opacity:.30; filter: alpha(opacity=30); -moz-opacity: 0.30;"');c+='<li class="'+d+'"'+e+">";for(d=0;d<this.layerInfo[h].iconUrl.length;d++)c+=
'<img src="'+this.layerInfo[h].iconUrl[d]+'" alt="icon '+d+" for "+this.layerInfo[h].title+'" class="iconBulletPoint" width="'+this.opts.iconWidth+'" height="'+this.opts.iconHeight+'" /> ';c+=""+this.layerInfo[h].title+' <a href="#" onclick="'+a.variableName+".changeLayerVisibility("+h+'); return false;">'+f+"</a>";this.opts.hiddenLayersRemovedFromList||(c+=' - <a href="#" onclick="'+a.variableName+".deleteLayer("+h+'); return false;">'+a._t.remove+"</a>");this.opts.addKmlLink&&this.layerInfo[h].url&&
(c+=' (<a href="'+this.layerInfo[h].url+'&kml=1">'+a._t.kml+"</a>)</li>")}b.innerHTML=c+"<ul>"}else console.debug("you defined the layerlist like this "+this.opts.layerListId+", but it does not exist")}},updateTitles:function(){for(var b=this.opts.defaultTitle,a=this.layerInfo.length-1;-1<a;a--)this.layerInfo[a].show&&(b=this.layerInfo[a].title,a=-99);this.opts.titleId&&(a=document.getElementById(this.opts.titleId),null!==a&&(a.innerHTML=b));this.opts.changePageTitle&&document.title&&(document.title=
b)},updateStatus:function(b,c){if(this.opts.statusDivId){var d=document.getElementById(this.opts.statusDivId);if(null!==d){"undefined"===typeof c&&(c=!1);"undefined"===typeof error&&(error=!1);var e="",f="";c&&(b&&(b+="<hr />"),b+="<hr />"+this.helpHtml()+"");document.getElementById(this.mapDivName)&&(this.mapIsZoomed?(f="reduce map size",e=""):(f="full-screen",e='<span>|</span> <a href="#" onclick="'+a.variableName+'.hideStatus();">'+a._t.hide+"</a> "));d.innerHTML='<p class="helpLink" style="text-align: right; font-size: 10px; width: auto; float: right;">'+
(' <a href="#" onclick="'+a.variableName+".updateStatus('', 'help'); return false;\"> "+a._t.show_help+' </a> <span>|</span> <a href="#" onclick="'+a.variableName+'.enlargeMap(); return false;" id="mapZoomLinkLabel">'+f+"</a> "+e+"</p>"+b);d.style.display="block"}}},recordError:function(b){jQuery("#map-error-message").remove();jQuery('<p id="map-error-message" class="message bad warning">'+b+"</p>").insertBefore("#"+a.mapDivName+"");window.setTimeout(function(){jQuery("#map-error-message").fadeOut(function(){jQuery("#map-error-message").remove()})},
5E3)},hideStatus:function(){if(this.opts.statusDivId){var b=document.getElementById(this.opts.statusDivId);null===b||this.mapIsZoomed?this.mapIsZoomed&&alert(a._t.can_not_hide_bar_in_full_screen_mode):(b=document.getElementById(this.opts.statusDivId),b.style.display="none")}},showAddress:function(b){var c="";this.opts.defaultCountryCode&&(c=this.opts.defaultCountryCode);a.geocoder=new google.maps.Geocoder;if(a.geocoder)return this.updateStatus(a._t.search_for_address),this.mapAddress=b,a.geocoder.geocode({address:b,
region:c},function(b,c){if(c==google.maps.GeocoderStatus.OK){console.debug(b);var d=b[0];a.addAddressToMap(d);a.mapObject.setCenter(d.geometry.location)}else alert("Geocode was not successful for the following reason: "+c)}),!1;this.updateStatus(a._t.address_finder_not_loaded)},addAddressToMap:function(b){place=b.geometry.location;var c=new google.maps.LatLng(place.lat(),place.lng());b=place.formatted_address;c=a.createPointXml(a._t.address_search+": "+a.mapAddress,c,b);a.processXml(c);a.updateStatus(a._t.address_found+
": "+b);b=a.opts.updateServerUrlAddressSearchPoint+encodeURIComponent(b)+"/"+place.lng()+"/"+place.lat()+"/";a.addLayer(b);return!0},updateAddressFormFields:function(b){a.opts.latFormFieldId&&null!==document.getElementById(a.opts.latFormFieldId)&&(document.getElementById(a.opts.latFormFieldId).value=b.lat(),document.getElementById(a.opts.lngFormFieldId).value=b.lng())},showRoute:function(){this.floatFrom?this.floatTo?(a.routeShown=!0,this.updateStatus(a._t.searching_for_route),a.directions.load(this.floatFrom+
" to "+this.floatTo,{locale:this.opts.localeForResults,getSteps:!0})):this.updateStatus(a._t.no_valid_end):this.updateStatus(a._t.no_valid_start)},createRouteFromLayer:function(b){var c=[],d=0,e=!1;2>this.layerInfo[b].pointCount&&(e=!0);for(var f=0;f<this.gmarkers.length;f++)if(this.gmarkers[f].layerId==b||!0===e)c[d]=d+1+": "+this.gmarkers[f].markerName+"@"+this.gmarkers[f].getPosition().lat()+","+this.gmarkers[f].getPosition().lng(),d++;c.length?(a.routeShown=!0,this.updateStatus(a._t.searching_for_route),
a.directions.route({origin:a.floatFrom,destination:a.floatTo,travelMode:google.maps.TravelMode.TRANSIT},function(b,c){c==google.maps.DirectionsStatus.OK&&a.directionsDisplay.setDirections(b)})):this.updateStatus(a._t.no_route_could_be_found)},currentFromLocation:function(){var b="";this.from?b='<span id="currentlySetToFrom">'+this.currentlySetToString+this.from+"</span>":this.floatFrom&&(b='<span id="currentlySetToTo">'+this.currentlySetToString+this.floatFrom+"</span>");return b},currentToLocation:function(){var b=
"";this.to?b=this.currentlySetToString+this.to:this.floatTo&&(b=this.currentlySetToString+this.floatTo);return b},clearRouteVariables:function(){this.to="";this.floatTo=0;this.from="";this.floatFrom=0;var b=document.getElementById("currentlySetToFrom");null!==b&&(b.innerHTML="");b=document.getElementById("currentlySetToTo");null!==b&&(b.innerHTML="")},clearRouteAll:function(){var b=document.getElementById(a.opts.directionsDivId);null!==b&&(b.innerHTML="");this.clearRouteVariables();this.routeShown=
!1;a.directions.clear();a.updateStatus("Route Cleared")},directionsHandleErrors:function(){a.directions.getStatus().code==G_GEO_UNKNOWN_ADDRESS?a.updateStatus("No corresponding geographic location could be found for one of the specified addresses. This may be due to the fact that the address is relatively new, or it may be incorrect.\nError code: "+a.directions.getStatus().code):a.directions.getStatus().code==G_GEO_SERVER_ERROR?a.updateStatus("A geocoding or directions request could not be successfully processed, yet the exact reason for the failure is not known.\n Error code: "+
a.directions.getStatus().code):a.directions.getStatus().code==G_GEO_MISSING_QUERY?a.updateStatus("The HTTP q parameter was either missing or had no value. For geocoder requests, this means that an empty address was specified as input. For directions requests, this means that no query was specified in the input.\n Error code: "+a.directions.getStatus().code):a.directions.getStatus().code==G_GEO_BAD_KEY?a.updateStatus("The given key is either invalid or does not match the domain for which it was given. \n Error code: "+
a.directions.getStatus().code):a.directions.getStatus().code==G_GEO_BAD_REQUEST?a.updateStatus("A directions request could not be successfully parsed.\n Error code: "+a.directions.getStatus().code):a.updateStatus("An unknown error occurred - Maybe the start or end address could not be found?")},directionsOnLoad:function(){function b(b,c,d,f){e+='<tr> <th colspan="2">  <a href="#" onclick="'+a.variableName+".mapObject.showMapBlowup(new google.maps.LatLng("+b.toUrlValue(6)+')); return false;">   <img src="http://www.google.com/intl/en_ALL/mapfiles/icon-dd-'+
c+'-trans.png" alt="marker">  </a>'+f+" ("+d+") </th></tr>"}function c(b,c,d,f){e+='<tr> <td>  <a href="#" onclick="'+a.variableName+".mapObject.showMapBlowup(new google.maps.LatLng("+b.toUrlValue(6)+')); return false;">'+c+".</a> "+d+' </td> <td class="dist">'+f+" </td></tr>"}function d(b){var a="",a=99<b?a+((b/1E3).toFixed(1)+"&nbsp;km."):a+(b+"&nbsp;me.");miles=6.21371192E-4*b;return a+=" / "+(miles.toFixed(1)+" mi.")}a.updateStatus("Route Found - Details Loading . . .");for(var e="",f=null,h=
null,g=null,k="",l="",n=0;n<a.directions.getNumRoutes();n++)for(0===n?(k="play",l=a.from):(k="pause",l=a.via),g=a.directions.getRoute(n),f=g.getStartGeocode(),h=g.getStep(0).getLatLng(),b(h,k,f.address,l),e+='<tr><th colspan="2" class="routeDistance">'+(d(g.getDistance().meters)+" - about "+g.getDuration().html)+"</th></tr>",f=0;f<g.getNumSteps();f++)h=g.getStep(f),c(h.getLatLng(),f+1,h.getDescriptionHtml(),d(h.getDistance().meters));f=g.getEndGeocode();h=g.getEndLatLng();l=a.to;b(h,"stop",f.address,
l);e+='<tr><th colspan="2" class="copyright">'+a.directions.getCopyrightsHtml()+"</th></tr>";e='<div id="directionsInnerDiv"> <table class="directionsClassTable"><col class="col1" /><col class="col2"/>'+e+"</table></div>";(g=document.getElementById(a.opts.directionsDivId))?(e+='<p id="directionsPrintOptions"><a href="#" onclick="'+a.variableName+'.printDirections(); return false;">Print Directions</a>, <a href="#" onclick="'+a.variableName+'.clearRouteAll(); return false;">Clear Route</a></p>',g.innerHTML=
e,a.updateStatus('Directions Loaded - <a href="#" onclick="'+a.variableName+'.printDirections(); return false;on">Print Directions</a>.')):a.openDirectionsPopup(e);a.updateStatus("Route Loaded");a.clearRouteVariables();a.attachStyleDirections(document)},enlargeMap:function(){var b=document.getElementById(this.mapDivName),c=document.getElementById("mapZoomLinkLabel");null!==b&&c&&(!0===this.mapIsZoomed?(b.style.width=this.mapOriginalSize.width+"px",b.style.height=this.mapOriginalSize.height+"px",b.style.position=
"relative",b.style.top="",b.style.left="",b.style.zIndex="",document.body.style.overflow="auto",this.mapIsZoomed=!1,c.innerHTML="full-screen"):(b.style.width=this.viewPortWidth()+"px",b.style.height=this.viewPortHeight()+"px",b.style.position="fixed",b.style.top=0,b.style.left=0,b.style.zIndex="9",document.body.style.overflow="hidden",this.mapIsZoomed=!0,c.innerHTML="original size"),a.mapObject.checkResize(),window.scrollTo(0,0))},printDirections:function(){var b=document.getElementById("directionsInnerDiv");
null!==b?a.openDirectionsPopup(b.innerHTML):a.updateStatus("Could not find directions.")},attachStyleDirections:function(b){var c=a.opts.styleSheetUrl;if(b.createStyleSheet)b.createStyleSheet(c);else{var d=document.createElement("link");d.rel="stylesheet";d.href=c;b.getElementsByTagName("head")[0].appendChild(d)}},openDirectionsPopup:function(b){var c="";b?c='<html><head><title>Directions</title><style type="text/css"></style><body onLoad="self.focus()"><p><a href="#" onclick="self.print(); return false;">Print This page</a>, <a href="#" onclick="self.close(); return false;">Close Window</a></p>'+
b+"</body></html>":a.updateStatus("Could not find directions.");(b=window.open("","directions","width=500,height=500,menubar=1,resizable=1,scrollbars=1").document)?(b.open(),b.write(c),a.attachStyleDirections(b),b.close()):alert("Could not open directions in new window, please try again.")},getlastMarkerLonLat:function(){return this.lastMarker.getPoint()},showMarkerFromList:function(b){a.closeLastInfoWindow();-1<b&&(google.maps.event.trigger(this.gmarkers[b],"click"),b=jQuery("#"+a.mapDivName),0<
b.length&&jQuery("html,body").animate({scrollTop:b.offset().top},1E3))},closeLastInfoWindow:function(){a.lastInfoWindow&&a.lastInfoWindow.close()},antipodeanPointer:function(b,a){b=0<b?-180+b:180+b;a*=-1;this.updateStatus("Hole Drilled!");return new google.maps.LatLng(a,b,!1)},checkLatitude:function(b){return b&&0!==b&&-90<=b&&90>=b?b:!1},checkLongitude:function(b){return b&&0!==b&&-180<=b&&180>=b?b:!1},checkZoom:function(b){return 0<b&&50>b?b:0},distancePerPixel:function(b){var c=a.mapObject.fromLatLngToDivPixel(b),
c=new google.maps.Point(c.x+10,c.y),c=a.mapObject.fromDivPixelToLatLng(c);return b.distanceFrom(c)/10},checkForHiddenMarkers:function(b){var a=[];if(1<this.gmarkers.length)for(var d=this.obscuringPixelDiv(b),e,f=0;f<this.gmarkers.length;f++)this.gmarkers[f].markerName!=b.markerName&&!this.gmarkers[f].view&&"marker"==this.gmarkers[f].type&&this.gmarkers[f].getPosition().lat()>=b.getPosition().lat()&&(e=this.obscuringPixelDiv(this.gmarkers[f]),this.GBoundIntersection(d,e)&&a.push(f));return[]},GBoundIntersection:function(b,
a){if(b[0]>=a[0]&&b[0]<=a[2]||b[2]>=a[0]&&b[2]<=a[2]||b[0]<=a[0]&&b[2]>=a[2])if(b[1]>=a[1]&&b[1]<=a[3]||b[3]>=a[1]&&b[3]<=a[3]||b[1]<=a[1]&&b[3]>=a[3])return!0;return!1},obscuringPixelDiv:function(a){var b=a.getIcon(),d=a.position;a=d.lat()-b.anchor.x;var e=d.lng()-b.anchor.y,b=d.lat()+(b.size.width-b.anchor.x),d=d.lng();return[a,e,b,d]},updateServerDone:function(b){a.updateStatus(b);a.updateStatus("done")},findAddressForm:function(){return' <p class="findAddressHtml">  <input type="text" size="60" id="mapAddress" class="infoTabInputAddress" />'+
a.opts.defaultAddressText+'  <input type="button" value="find address" id="infoTabSubmitAddress" class="submitButton" onclick="'+a.variableName+".findAddress(document.getElementById('mapAddress').value); return false;\" /> </p>"},helpHtml:function(){var a="<ul><li><b>keyboard tricks:</b><ul><li>keys <i>up</i>, <i>down</i>, <i>left</i>, <i>right</i>: moves the map continuously while the key is pressed. Two keys can be pressed simultaneously in order to move diagonally.</li><li>keys <i>+</i>, <i>-</i>: zoom in and out respectively</li></ul></li><li><b>mouse tricks:</b><ul><li><i>click on a marker</i> to find out more about the location<li><i>click</i> anywhere else on the map to zoom-in on that particular point</li><li><i>click-and-hold-down</i> anywhere on the map to drag in any direction</li>",
a=this.opts.addPointsToMap?a+"<li><i>right-mouse-click</i> on the map to add a marker (for example for creating a route)</li><li><i>right-mouse-click</i> on a marker to delete it</li>":a+"<li><i>right-mouse-click</i> to zoom out</li>",a=a+"</ul></li>";this.opts.addKmlLink&&(a+='<li><b>KML files</b> are for use in <a href="http://earth.google.com">Google Earth</a>.Download KML files, save them to the desktop and open them.  From there, the should automatically start Google Earth.</li>');this.opts.addDirections&&
(a+="<li><b>Finding directions</b> can be done by clicking on a first marker and choosing <i>from here</i> under the <i>directions</i> tab, then doing the same for another marker choosing the <i>to here</i> link. Finally, click on the <i>calculate route</i> link at the bottom of the <i>directions</i> tab and the map will calculate your route.</li>");return a+"<li>many thanks to: http://econym.googlepages.com</li><li>module developed by www.sunnysideup.co.nz</li><li>To <b>hide</b> help from the map, just click on the (x).</li></ul>"},
viewPortWidth:function(){return"undefined"!=typeof window.innerWidth?window.innerWidth:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientWidth&&0!==document.documentElement.clientWidth?document.documentElement.clientWidth:document.getElementsByTagName("body")[0].clientHeight},viewPortHeight:function(){return"undefined"!=typeof window.innerHeight?window.innerHeight:"undefined"!=typeof document.documentElement&&"undefined"!=typeof document.documentElement.clientHeight&&
0!==document.documentElement.clientHeight?document.documentElement.clientHeight:document.getElementsByTagName("body")[0].clientHeight}};return{getMap:function(){return a},getVar:function(b){if(a.hasOwnProperty(b))return a[b]},setVar:function(b,c){a[b]=c;return this},addLayer:function(b,c){return a.addLayer(b,c)},addPoint:function(b,c,d){a.addPoint(b,c,d)},findAddress:function(b){return a.findAddress(b)},findRoute:function(){return a.findRoute()},savePosition:function(){return a.savePosition()},goToSavedPosition:function(){return a.goToSavedPosition()},
init:function(){a.opts=n||{};a.mapDivName=g;a.mapIsZoomed=!1;a.mapOriginalSize={};a.defaultUrl=l||"";a.latestUrl=l||"";a.currentPageURL=location.href.replace(/#/g,"");a.gmarkers=[];a.layerInfo=[];a.lastMarker={};a.markerImageCollection=[];a.imageNum=0;a.previousPosition=null;a.opts.defaultLatitude||(a.opts.defaultLatitude=a.NZLatitude);a.opts.defaultLongitude||(a.opts.defaultLongitude=a.NZLongitude);a.opts.defaultZoom||(a.opts.defaultZoom=a.NZZoom);a.opts.defaultTitle||(a.opts.defaultTitle=a._t.map_ready);
var b;a.opts.changePageTitle&&(document.title=a.opts.defaultTitle);a.opts.titleId&&(b=document.getElementById(a.opts.titleId),null!==b&&(b.innerHTML=a.opts.defaultTitle));a.opts.layerListId&&(b=document.getElementById(a.opts.layerListId),null!==b?b.innerHTML="":a.opts.layerListId="");a.opts.sideBarId&&(b=document.getElementById(a.opts.sideBarId),null!==b?b.innerHTML="":a.opts.sideBarId="");a.opts.dropBoxId&&(b=document.getElementById(a.opts.dropBoxId),null!==b?b.innerHTML="":a.opts.dropBoxId="");
a.opts.statusDivId?(b=document.getElementById(a.opts.statusDivId),null!==b?b.innerHTML=a._t.loading_map:a.opts.statusDivId="statusDivOnMap"):a.opts.statusDivId="statusDivOnMap";a.opts.directionsDivId&&(b=document.getElementById(a.opts.directionsDivId),null!==b?b.innerHTML="":a.opts.directionsDivId="");a.clearRouteVariables();a.mapAddress="";a.currentlySetToString="<br />"+a._t.currently_set_to;a.map||a.setupMap(g);b=new google.maps.LatLng(a.opts.defaultLatitude,a.opts.defaultLongitude,!1);a.zoomTo(b,
a.opts.defaultZoom);a.mapObject.clearOverlays(a.markersArray);a.opts.mapTypeDefault&&(b=a.mapTypesArray(a.opts.mapTypeDefault-0),a.mapObject.setMapTypeId(b));a.defaultUrl&&a.downloadXml(a.defaultUrl);a.mapOriginalSize={width:a.mapObject.getDiv().offsetWidth,height:a.mapObject.getDiv().offsetHeight};a.updateStatus(a._t.map_ready)}}}Array.prototype.inArray=function(g){for(var l=0;l<this.length;l++)if(this[l]===g)return l+1;return!1};
Array.prototype.inSubArray=function(g,l){for(var q=[],n=0;n<this.length;n++)q.push(this[n][g]);return q.inArray(l)};function mapFunctionIsDefined(g){return"undefined"==typeof window[g]?!1:!0}"undefined"!==typeof google&&(google.maps.Map.prototype.clearOverlays=function(g){for(var l=0;l<g.length;l++)g[l].setMap(null)});
function createXmlHttpRequest(){try{if("undefined"!=typeof ActiveXObject)return new ActiveXObject("Microsoft.XMLHTTP");if(window.XMLHttpRequest)return new XMLHttpRequest}catch(g){changeStatus(g)}return null}function downloadUrl(g,l){var q=-1,n=createXmlHttpRequest();if(!n)return!1;n.onreadystatechange=function(){if(4==n.readyState){try{q=n.status}catch(a){}200==q&&(l(xmlParse(n.response),n.status),n.onreadystatechange=function(){})}};n.open("GET",g,!0);try{n.send(null)}catch(a){changeStatus(a)}}
function xmlParse(g){if("undefined"!=typeof ActiveXObject&&"undefined"!=typeof GetObject){var l=new ActiveXObject("Microsoft.XMLDOM");l.loadXML(g);return l}return"undefined"!=typeof DOMParser?(new DOMParser).parseFromString(g,"text/xml"):createElement("div",null)};
